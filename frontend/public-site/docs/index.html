<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentation — Nightjar</title>
  <meta name="description" content="Nightjar documentation — guides for identity, workspaces, documents, collaboration, security, and more.">
  <link rel="icon" href="/nightjar-64.png" type="image/png">
  <link rel="stylesheet" href="docs.css">
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <a href="/" class="topbar-brand">
      <img src="/nightjar-logo.png" alt="Nightjar">
      Nightjar Docs
    </a>
    <div class="topbar-links">
      <a href="/">Home</a>
      <a href="https://github.com/NiyaNagi/Nightjar" target="_blank" rel="noopener">GitHub</a>
      <a href="https://github.com/NiyaNagi/Nightjar/releases" target="_blank" rel="noopener">Releases</a>
    </div>
  </div>

  <div class="docs-layout">
    <!-- Sidebar -->
    <nav class="docs-sidebar" id="sidebar"></nav>

    <!-- Hub content -->
    <main class="docs-hub">
      <h1>Nightjar Documentation</h1>
      <p class="subtitle">Guides and references for every feature — from getting started to advanced networking.</p>
      <div class="hub-grid" id="hub-grid"></div>
    </main>
  </div>
  <div class="docs-sidebar-backdrop" id="sidebar-backdrop"></div>
  <button class="mobile-sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">☰</button>

  <div class="docs-footer">
    Nightjar · <a href="https://github.com/NiyaNagi/Nightjar" target="_blank" rel="noopener">Open Source</a> · Built by <a href="https://github.com/NiyaNagi" target="_blank" rel="noopener">NiyaNagi</a>
  </div>

  <script>
    const CONTENT_BASE = '/content';

    function escapeHTML(str) {
      const el = document.createElement('span');
      el.textContent = str;
      return el.innerHTML;
    }

    async function init() {
      try {
        const res = await fetch(`${CONTENT_BASE}/index.json`);
        if (!res.ok) return;
        const index = await res.json();
        const sections = index.sections || [];

        // Build sidebar with search
        const sidebar = document.getElementById('sidebar');
        const navHTML = '<div class="sidebar-search"><svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input type="text" placeholder="Search docs…" id="sidebar-search" aria-label="Search documentation"></div><h3>Documentation</h3><ul id="sidebar-list">' +
          sections.map(s => `<li data-title="${escapeHTML(s.title.toLowerCase())}" data-summary="${escapeHTML((s.summary || '').toLowerCase())}"><a href="${s.id}.html"><span class="icon">${s.icon}</span><span class="sidebar-label">${escapeHTML(s.title)}</span></a></li>`).join('') +
          '</ul>';
        sidebar.innerHTML = navHTML;

        // Search filter
        const searchInput = document.getElementById('sidebar-search');
        searchInput.addEventListener('input', () => {
          const q = searchInput.value.toLowerCase().trim();
          document.querySelectorAll('#sidebar-list li').forEach(li => {
            const match = !q || li.dataset.title.includes(q) || li.dataset.summary.includes(q);
            li.style.display = match ? '' : 'none';
          });
          // Also filter hub cards
          document.querySelectorAll('.hub-card').forEach(card => {
            const title = card.querySelector('h3').textContent.toLowerCase();
            const desc = card.querySelector('p').textContent.toLowerCase();
            card.style.display = (!q || title.includes(q) || desc.includes(q)) ? '' : 'none';
          });
        });

        // Mobile sidebar toggle with backdrop and scroll lock
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarBackdrop = document.getElementById('sidebar-backdrop');
        function closeSidebar() {
          sidebar.classList.remove('open');
          sidebarBackdrop?.classList.remove('open');
          if (sidebarToggle) sidebarToggle.textContent = '☰';
          document.body.style.overflow = '';
        }
        if (sidebarToggle) {
          sidebarToggle.addEventListener('click', () => {
            const isOpen = sidebar.classList.toggle('open');
            sidebarBackdrop?.classList.toggle('open', isOpen);
            sidebarToggle.textContent = isOpen ? '✕' : '☰';
            document.body.style.overflow = isOpen ? 'hidden' : '';
          });
        }
        if (sidebarBackdrop) {
          sidebarBackdrop.addEventListener('click', closeSidebar);
        }
        sidebar.addEventListener('click', (e) => {
          if (e.target.closest('a')) closeSidebar();
        });

        // Build hub grid
        const grid = document.getElementById('hub-grid');
        grid.innerHTML = sections.map(s =>
          `<a href="${s.id}.html" class="hub-card">
            <div class="icon">${s.icon}</div>
            <h3>${escapeHTML(s.title)}</h3>
            <p>${escapeHTML(s.summary)}</p>
          </a>`
        ).join('');
      } catch (e) {
        console.warn('Failed to load docs index:', e);
      }
    }
    init();
  </script>
</body>
</html>
